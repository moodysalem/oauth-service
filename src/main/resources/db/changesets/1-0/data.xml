<databaseChangeLog
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

  <changeSet id="Required Data" author="moody.salem">
    <!-- this is the oauth administrative interface -->
    <insert tableName="Application">
      <column name="id">1</column>
      <column name="name">OAuth2 Cloud</column>
      <column name="description">An OAuth2 Application as a service.</column>
      <column name="supportEmail">moody@oauth2cloud.com</column>
      <column name="facebookAppId">725381047606159</column>
      <column name="googleClientId">520864329427-r8nf78v9oiqatdhca5sumqjn39q9q2hs.apps.googleusercontent.com</column>
      <column name="amazonClientId">amzn1.application-oa2-client.fca66588ac9f4914ac23a931f5d45f7b</column>
      <column name="stylesheetUrl">
        https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/cosmo/bootstrap.min.css
      </column>
      <column name="publicClientRegistration" valueBoolean="true"/>
    </insert>

    <!-- create the admin user of app 1 -->
    <insert tableName="User">
      <column name="id">1</column>
      <column name="applicationId">1</column>
      <column name="firstName">Moody</column>
      <column name="lastName">Salem</column>
      <column name="email">moody.salem@gmail.com</column>
      <column name="password">$2a$10$jGLkWP/A24QL6wEf73FDqe1IKUhr3zKLxpLC4mjmexh1HJAi3JNwa</column>
      <column name="verified" valueBoolean="true"/>
    </insert>

    <!-- set the owner to app 1 -->
    <update tableName="Application">
      <column name="ownerId" valueNumeric="1"/>
      <where>id=1</where>
    </update>

    <!-- complete schema by making sure applications cannot be without owners -->
    <addNotNullConstraint tableName="Application" columnName="ownerId" columnDataType="BIGINT"/>

    <!-- admin interface -->
    <insert tableName="Client">
      <column name="id">1</column>
      <column name="name">Administration</column>
      <column name="type">PUBLIC</column>
      <column name="identifier">6a63c1f1f10df85df6f918d68cb8c13e1e44856f7d861b05cbdd63bf7ea009f4</column>
      <column name="secret">0457a1fe452b7f32e4b84db9db139d9a572bad7599544ac368a079bbe8069714</column>
      <column name="applicationId">1</column>
      <column name="tokenTtl">86400</column>
      <column name="creatorId">1</column>
    </insert>

    <!-- only allow implicit flow -->
    <insert tableName="Client_Flow">
      <column name="clientId">1</column>
      <column name="flow">IMPLICIT</column>
    </insert>

    <!-- allow https://oauth2cloud.com -->
    <insert tableName="Client_URI">
      <column name="clientId">1</column>
      <column name="uri">https://oauth2cloud.com</column>
    </insert>

    <!-- create scopes we use in the api -->
    <insert tableName="Scope">
      <column name="id">1</column>
      <column name="applicationId">1</column>
      <column name="name">manage_applications</column>
      <column name="displayName">Manage Applications</column>
      <column name="description">
        Permission to create, view, edit, and delete your applications and application settings.
      </column>
      <column name="requiresApprovalFromApplication" valueBoolean="true"/>
    </insert>
    <insert tableName="Scope">
      <column name="id">2</column>
      <column name="applicationId">1</column>
      <column name="name">manage_clients</column>
      <column name="displayName">Manage Clients</column>
      <column name="description">
        Permission to create, view, edit, and delete clients for your applications.
      </column>
      <column name="requiresApprovalFromApplication" valueBoolean="true"/>
    </insert>
    <insert tableName="Scope">
      <column name="id">3</column>
      <column name="applicationId">1</column>
      <column name="name">manage_client_scopes</column>
      <column name="displayName">Manage Client Scopes</column>
      <column name="description">
        Permission to change the scopes that a client can use and their priorities.
      </column>
      <column name="requiresApprovalFromApplication" valueBoolean="true"/>
    </insert>
    <insert tableName="Scope">
      <column name="id">4</column>
      <column name="applicationId">1</column>
      <column name="name">manage_scopes</column>
      <column name="displayName">Manage Scopes</column>
      <column name="description">
        Permission to create, view, edit, and delete application scopes.
      </column>
      <column name="requiresApprovalFromApplication" valueBoolean="true"/>
    </insert>
    <insert tableName="Scope">
      <column name="id">5</column>
      <column name="applicationId">1</column>
      <column name="name">manage_users</column>
      <column name="displayName">Manage Users</column>
      <column name="description">
        Permission to create, view, edit, and delete users of your applications.
      </column>
      <column name="requiresApprovalFromApplication" valueBoolean="true"/>
    </insert>

    <!-- give it all the scopes -->
    <insert tableName="ClientScope">
      <column name="clientId">1</column>
      <column name="scopeId">1</column>
      <column name="priority">ALWAYS</column>
      <column name="approved" valueBoolean="true"/>
    </insert>

    <insert tableName="ClientScope">
      <column name="clientId">1</column>
      <column name="scopeId">2</column>
      <column name="priority">ALWAYS</column>
      <column name="approved" valueBoolean="true"/>
    </insert>

    <insert tableName="ClientScope">
      <column name="clientId">1</column>
      <column name="scopeId">3</column>
      <column name="priority">ALWAYS</column>
      <column name="approved" valueBoolean="true"/>
    </insert>

    <insert tableName="ClientScope">
      <column name="clientId">1</column>
      <column name="scopeId">4</column>
      <column name="priority">ALWAYS</column>
      <column name="approved" valueBoolean="true"/>
    </insert>

    <insert tableName="ClientScope">
      <column name="clientId">1</column>
      <column name="scopeId">5</column>
      <column name="priority">ALWAYS</column>
      <column name="approved" valueBoolean="true"/>
    </insert>

  </changeSet>


  <changeSet id="Testing Data" author="moody.salem" context="test">
    <insert tableName="Client_URI">
      <column name="clientId">1</column>
      <column name="uri">http://localhost:8080</column>
    </insert>
    <insert tableName="Client_URI">
      <column name="clientId">1</column>
      <column name="uri">http://localhost:3000</column>
    </insert>

    <insert tableName="Token">
      <column name="id">1</column>
      <column name="token">abc</column>
      <column name="clientId">1</column>
      <column name="userId">1</column>
      <column name="redirectUri">http://localhost:8080/</column>
      <column name="expires" valueComputed="TIMESTAMPADD(DAY, 1, ${now})"/>
      <column name="type">ACCESS</column>
    </insert>
  </changeSet>

  <changeSet id="Test LoginCookie" author="moody.salem" context="test">
    <insert tableName="LoginCookie">
      <column name="secret">abc</column>
      <column name="rememberMe" valueBoolean="true"/>
      <column name="userId">1</column>
      <column name="expires" valueComputed="TIMESTAMPADD(DAY, 1, ${now})"/>
    </insert>
  </changeSet>


</databaseChangeLog>